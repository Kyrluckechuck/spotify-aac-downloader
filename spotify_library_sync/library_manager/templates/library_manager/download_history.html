{% load static %}
<head>
    <link rel="stylesheet" href="{% static 'library_manager/style.css' %}">
</head>
<body>
    <h2 class="importer_header"><img src="{% static 'library_manager/images/spotify_icon_128.png' %}" width="128" height="128"><div class="title">Spotify AAC Downloader</div></h2>
    <br>
    This is the download history page
    <br>
    <a href="{% url 'library_manager:index' %}">Home</a>
    <br>

    <form action="{% url 'library_manager:download_playlist' %}" method="post">
        {% csrf_token %}
        
        {{ playlist_form }}
        <input type="submit" name='download playlist' value="Download">
    </form>

    {% if download_history %}
    <ul>
    {% for download_details in download_history %}
        <li>
            Added: {{ download_details.added_at }}
            <br/>
            Completed: {{ download_details.completed_at }}
            <br/>
            Progress: {{ download_details.progress_percent }}%
            <br/>
            URL: <a id="download_id_{{ download_details.id }}" href="{{ download_details.url }}">{{ download_details.url }}</a>
            <br/>

            <button style="text-align:center;" onclick="CopyText('download_id_{{ download_details.id }}')">Copy URL</button>
        </li>
    {% endfor %}
    </ul>
    {% else %}
        <p>No download history available.</p>
    {% endif %}

    

</body>
<footer>

</footer>

{% block scripts %}
<script>
function CopyText(textIdToCopy) {
    var text = document.getElementById(textIdToCopy)
    navigator.clipboard.writeText(text.href);
}
</script>
{% endblock scripts %}